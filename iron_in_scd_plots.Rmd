---
title: Iron in SCD multivariate analyses
output: html_document
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(ggforce)
library(corrr)

```

```{r data}

# import
df_mice <- read.csv("data/Majed's mice.csv") %>% 
  as_tibble() %>% 
  dplyr::select(-c(X, X.1, X.2)) %>% 
  filter(!is.na(Mouse.ID))

# format
df_mice <- df_mice %>% 
  mutate_if(is.character, factor) %>% 
  mutate_if(is.integer, as.numeric) %>% 
  mutate(timepoint..month. = as.factor(timepoint..month.)) %>% 
  mutate(hepatic.necrosis..yes.no. = factor(ifelse(hepatic.necrosis..yes.no. == "Y", 1, 0))) %>% 
  
  dplyr::rename(
    
    "timepoint" = "timepoint..month.",
    "Ferritin (ng/mL)" = "Ferritin..ng.ml.",
    "HAMP1 (cDNA/ng)" = "HAMP1..cDNA.ng.",
    "Hepcidin (ng/mL)" = "Hepcidin..ng.ml.",
    "Plasma heme (µM)" = "Plasma.Heme..µM.",
    "Haptoglobin (ng/mL)" = "Haptoglobin..ng.ml.",
    "Hemopexin (ng/mL)" = "Hemopexin..ng.ml.",
    "P50 (mm/Hg)" = "P50..mm.Hg.",
    "Round cell half life (min)" = "Round.cell.half.life..minutes.",
    "RBC 10^6 (µL)" = "RBC..10.6.uL.",
    "Hb (g/dL)" = "Hb..g.dL.",
    "HCT (%)" = "HCT....",
    "MCV (fL)" = "MCV..fL.",
    "MCH (pg)" = "MCH..pg.",
    "MCHC (g/dL)" = "MCHC..g.dL.",
    "MCHC-O (g/dL)" = "MCHC.O..g.dL.",
    "RDW (%)" = "RDW....",
    "RET" = "RET.",
    "ARC 10^6 (µL)" = "ARC..10.6.uL.",
    "Ret-He (pg)" = "Ret.He..pg.",
    "Hepatic necrosis" = "hepatic.necrosis..yes.no.",
    "Spleen IDS" = "iron.deposition.score..0.4...spleen.",
    "Liver IDS" = "iron.deposition.score..0.4...liver.",
    "Kidney IDS" = "iron.deposition.score..0.4..kidney."
    
  ) %>% 
  
  mutate(treatment = ifelse(treatment == "sufficient", "Sufficient", "Deficient")
    
  )

```

#### Correlations
```{r plot1, fig.width = 8, fig.height = 8}
df_correlate <- df_mice %>% dplyr::select(-c(1:4, 24))
mice_cor <- df_correlate %>% correlate(method = "spearman", diagonal = NA)

# plot
rplot(mice_cor, colors = c("deepskyblue1", "white", "coral"), print_cor = TRUE) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.9))
```

#### Comparisons
```{r plot2, fig.width = 15, fig.height = 49.5}

cols <- c("2" = "#505050", "4" = "#505050", "6" = "#505050", "M" = "#F8766D", "F" = "#00BFC4")

df_mice %>% 
  dplyr::select(-c(`Hepatic necrosis`, `Spleen IDS`, `Liver IDS`, `Kidney IDS`)) %>% 
  pivot_longer(cols = 5:ncol(.), names_to = "variable", values_to = "value") %>% 
  mutate(treatment = factor(treatment, levels = c("Sufficient", "Deficient"))) %>% 
  
  ggplot(aes(x = treatment, y = value)) +
  geom_point(aes(color = sex), position = position_dodge(0.5), size = 3, shape = 1) +
  stat_summary(fun = "median", geom = "crossbar", aes(color = timepoint), position = position_dodge(), size = .3) +
  stat_summary(fun = "median", geom = "crossbar", aes(fill = timepoint, color = sex), position = position_dodge(), size = .2, lty = 2) +
  
  facet_grid(variable ~ timepoint, scales = "free_y") +
  labs(y = "") +
  scale_color_manual(values = cols) +
  theme_bw() +
  theme(legend.position = "none",
        axis.title.x = element_text(size = 20),
        axis.text = element_text(size = 17),
        strip.text = element_text(size = 15))

```

#### Iron deposition scores
```{r plot3, fig.width = 12}
df_mice %>% mutate(timepoint = as.numeric(as.character(timepoint)),
                   treatment_sex = factor(paste0(treatment, sep = "_", sex))) %>% 
  
  group_by(treatment, timepoint, sex, treatment_sex) %>% 
  summarise(`Mean spleen IDS` = mean(`Spleen IDS`, na.rm = TRUE), 
            `Mean liver IDS` = mean(`Liver IDS`, na.rm = TRUE), 
            `Mean kidney IDS` = mean(`Kidney IDS`, na.rm = TRUE)) %>% 
  pivot_longer(5:ncol(.)) %>% 
  
  ggplot(aes(x = timepoint, y = value)) +
  geom_point(aes(color = treatment_sex), size = 3, alpha = 0.5) +
  geom_line(aes(color = treatment_sex)) +
  facet_wrap(~name) +
  scale_x_continuous(breaks = c(2, 4, 6)) +
  labs(y = NULL, x = "timepoint (month)") +
  theme_bw()
```

